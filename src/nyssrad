#!/usr/bin/env coffee
cmd = require './prompt'
data = require './data'
env = require './env'
config = require './config'
log = require './log'
daemon = require './daemon'
argv = require('optimist').argv

for arg, i in process.argv
    process.argv[i] = null if arg == '--start' || arg == '--stop'

if argv.start
    daemon.start()
else if argv.stop
    daemon.stop()
else
    if argv.store
        log.warn 'Loading store form file ' + argv.store + ', default store is not loaded!'
        data.setFilename argv.store

    if argv.port
        config.server.port = argv.port

    if config.store.flush.interval
        data.registerFlushing()

    data.load()

    if argv.server
        server = require './server'

        server.start()
    else
        log.message "\nnyssrad " + env.VERSION + " - noSQL key-value-database"
        log.glitzer "Copyright (C) 2012, 2013 Alexander Kluth <contact@alexanderkluth.com>, Patrick Pokatilo <mail@shyxormz.net>"
        log.message "Distributed under the terms of the MIT license\n"
        cmd.prompt()
